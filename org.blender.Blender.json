{
    "id": "org.blender.Blender",
    "default-branch": "beta",
    "runtime": "org.freedesktop.Platform",
    "runtime-version": "18.08",
    "sdk": "org.freedesktop.Sdk",
    "command": "blender",
    "rename-desktop-file": "blender.desktop",
    "rename-icon": "blender",
    "finish-args": [
        "--share=ipc",
        "--socket=x11",
        "--socket=pulseaudio",
        "--device=dri",
        "--share=network",
        "--filesystem=host"
        ],
    "modules": [
        "shared-modules/glu/glu-9.0.0.json",
        "shared-modules/glew/glew.json",
        {
            "name": "numpy",
            "buildsystem": "simple",
            "build-commands": [
                "/usr/bin/pip3 install --prefix=/app --no-deps --verbose ."
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/source/n/numpy/numpy-1.15.4.zip",
                    "sha256": "3d734559db35aa3697dadcea492a423118c5c55d176da2f3be9c98d4803fc2a7"
                }
            ],
            "cleanup": [
                "/bin",
                "/lib/python3.*/site-packages/numpy/core/lib/libnpymath.a",
                "/lib/python3.*/site-packages/numpy/tests",
                "/lib/python3.*/site-packages/numpy/*/tests"
            ]
        },
        {
            "name": "boost",
            "buildsystem": "simple",
            "build-commands": [
                "./bootstrap.sh --prefix=/app --with-libraries=date_time,filesystem,iostreams,locale,regex,system,thread",
                "./b2 --build-type=minimal link=shared",
                "./b2 --build-type=minimal link=shared install"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://downloads.sourceforge.net/project/boost/boost/1.68.0/boost_1_68_0.tar.bz2",
                    "sha256": "7f6130bc3cf65f56a618888ce9d5ea704fa10b462be126ad053e80e553d6d8b7"
                }
            ],
            "cleanup": [
                "/include"
            ]
        },
        {
            "name": "opencolorio",
            "buildsystem": "cmake",
            "builddir": true,
            "build-options" : {
                "env": {
                    "CXXFLAGS": "-Wno-error=unused-function -Wno-error=deprecated-declarations -Wno-error=cast-function-type"
                },
                "arch" : {
                    "arm" : {
                        "config-opts" : [
                            "-DOCIO_USE_SSE:BOOL=OFF"
                        ]
                    },
                    "aarch64" : {
                        "config-opts" : [
                            "-DOCIO_USE_SSE:BOOL=OFF"
                        ]
                    }
                }
            },
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=RelWithDebInfo",
                "-DOCIO_BUILD_APPS:BOOL=OFF",
                "-DOCIO_BUILD_DOCS:BOOL=OFF",
                "-DOCIO_BUILD_STATIC:BOOL=OFF",
                "-DOCIO_BUILD_TESTS:BOOL=OFF",
                "-DOCIO_BUILD_JNIGLUE:BOOL=OFF",
                "-DOCIO_STATIC_JNIGLUE:BOOL=OFF",
                "-DPYTHON=/usr/bin/python3"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/imageworks/OpenColorIO/archive/v1.1.0.tar.gz",
                    "sha256": "228589879e1f11e455a555304007748a8904057088319ebbf172d9384b93c079"
                }
            ],
            "cleanup": [
                "/*.cmake",
                "/include",
                "/lib/pkgconfig",
                "/share"
            ]
        },
        {
            "name": "ilmbase",
            "build-options": {
                "env": {
                    "LDFLAGS": "-lpthread"
                }
            },
            "config-opts": [
                "--enable-shared",
                "--disable-static"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/openexr/openexr/releases/download/v2.3.0/ilmbase-2.3.0.tar.gz",
                    "sha256": "456978d1a978a5f823c7c675f3f36b0ae14dba36638aeaa3c4b0e784f12a3862"
                }
            ],
            "cleanup": [
                "/include/OpenEXR",
                "/lib/libHalf.la",
                "/lib/libIex*.la",
                "/lib/libIlm*.la",
                "/lib/libImath*.la",
                "/lib/pkgconfig/IlmBase.pc"
            ]
        },
        {
            "name": "openexr",
            "config-opts": [
                "--enable-shared",
                "--disable-static"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/openexr/openexr/releases/download/v2.3.0/openexr-2.3.0.tar.gz",
                    "sha256": "fd6cb3a87f8c1a233be17b94c74799e6241d50fc5efd4df75c7a4b9cf4e25ea6"
                }
            ],
            "cleanup": [
                "/bin",
                "/include",
                "/lib/*.la",
                "/lib/pkgconfig",
                "/share/aclocal"
            ]
        },
        {
            "name": "openimageio",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DOIIO_BUILD_TOOLS:BOOL=OFF",
                "-DOIIO_BUILD_TESTS:BOOL=OFF",
                "-DBUILDSTATIC:BOOL=OFF",
                "-DINSTALL_DOCS:BOOL=OFF",
                "-DOpenGL_GL_PREFERENCE:STRING=GLVND",

                /* Upstream Blender releases bundle OpenImageIO built with these options */
                "-DUSE_QT:BOOL=OFF",
                "-DUSE_PYTHON:BOOL=OFF",
                "-DUSE_FFMPEG:BOOL=OFF",
                "-DUSE_OPENCV:BOOL=OFF"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/OpenImageIO/oiio/archive/Release-1.8.17.tar.gz",
                    "sha256": "a019086c05a6150d445a2240bab1723dff540dde5f5c327c36a97f0b5ae0e157"
                }
            ],
            "cleanup": [
                "/include"
            ]
        },
        {
            "name": "openjpeg",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=RelWithDebInfo",
                "-DBUILD_CODEC:BOOL=OFF",
                "-DBUILD_DOC:BOOL=OFF",
                "-DBUILD_TESTING:BOOL=OFF"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/uclouvain/openjpeg/archive/v2.3.0.tar.gz",
                    "sha256": "3dc787c1bb6023ba846c2a0d9b1f6e179f1cd255172bde9eb75b01f1e6c7d71a"
                }
            ],
            "cleanup": [
                "/include",
                "/lib/openjpeg-1.5",
                "/lib/pkgconfig",
                "/share"
            ]
        },
        {
            "name": "opensubdiv",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DGLEW_LOCATION=/app",
                "-DNO_EXAMPLES=1",
                "-DNO_TUTORIALS=1",
                "-DNO_PTEX=1",
                "-DNO_DOC=1"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://github.com/PixarAnimationStudios/OpenSubdiv.git",
                    "branch": "v3_3_3"
                }
            ],
            "cleanup": [
                "/include",
                "/bin",
                "/share"
            ]
        },
        {
            "name": "x264",
            "config-opts": [
                "--enable-shared",
                "--disable-cli"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://ftp.videolan.org/pub/x264/snapshots/x264-snapshot-20190114-2245-stable.tar.bz2",
                    "sha256": "8e10725c30da0ac9d22267a217c28715567b8571ff44397c76d8b4ea8b1f7797"
                }
            ],
            "cleanup": [
                "/include",
                "/lib/pkgconfig"
            ]
        },
        {
            "name": "ffmpeg",
            "config-opts": [
                "--enable-shared",
                "--disable-static",
                "--disable-doc",
                "--enable-gpl",
                "--enable-version3",
                "--disable-nonfree",
                "--enable-optimizations",
                "--enable-pthreads",

                "--disable-bzlib",
                "--disable-libgsm",
                "--enable-libtheora",
                "--enable-libvorbis",
                "--enable-libvpx",
                "--enable-libx264",
                "--enable-zlib",
                "--disable-libxcb",
                "--disable-lzma",

                "--disable-programs",
                "--disable-network",

                "--disable-protocols",
                "--enable-protocol=file",

                "--disable-devices",

                "--enable-muxer=avi",
                "--enable-muxer=h264",
                "--enable-muxer=mov",
                "--enable-muxer=mp4",
                "--enable-muxer=ogg",
                "--enable-muxer=webm",

                "--enable-demuxer=avi",
                "--enable-demuxer=h264",
                "--enable-demuxer=mov",
                "--enable-demuxer=mp3",
                "--enable-demuxer=ogg",
                "--enable-demuxer=wav",

                "--enable-parser=h264",
                "--enable-parser=vorbis",

                "--enable-encoder=aac",
                "--enable-encoder=libtheora",
                "--enable-encoder=libvorbis",
                "--enable-encoder=libvpx_vp8",
                "--enable-encoder=libvpx_vp9",
                "--enable-encoder=libx264",
                "--enable-encoder=mpeg4",

                "--enable-decoder=aac",
                "--enable-decoder=h264",
                "--enable-decoder=libvorbis",
                "--enable-decoder=libvpx_vp8",
                "--enable-decoder=libvpx_vp9",
                "--enable-decoder=mp3",
                "--enable-decoder=mpeg4",
                "--enable-decoder=pcm_s16le",
                "--enable-decoder=theora"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://www.ffmpeg.org/releases/ffmpeg-4.0.3.tar.xz",
                    "sha256": "253c37e3f1d3626a2566e496554de9a4c29050753660835909a466d66b12e2ed"
                }
            ],
            "cleanup": [
                "/include",
                "/lib/pkgconfig"
            ]
        },
        {
            "name": "fftw",
            "build-options" : {
                "arch" : {
                    "x86_64" : {
                        "config-opts" : [
                            "--enable-sse2",
                            "--enable-avx"
                        ]
                    }
                }
            },
            "config-opts": [
                "--enable-shared",
                "--enable-threads",
                "--enable-openmp"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "http://www.fftw.org/fftw-3.3.8.tar.gz",
                    "sha256": "6113262f6e92c5bd474f2875fa1b01054c4ad5040f6b0da7c03c98821d9ae303"
                }
            ],
            "cleanup": [
                "/bin",
                "/include",
                "/lib/*.a",
                "/lib/*.la",
                "/lib/cmake",
                "/lib/pkgconfig",
                "/share/info",
                "/share/man"
            ]
        },
        {
            "name": "opencollada",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=RelWithDebInfo",
                "-DUSE_EXPAT:BOOL=OFF",
                "-DUSE_LIBXML:BOOL=ON",
                "-DUSE_STATIC:BOOL=ON"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/KhronosGroup/OpenCOLLADA/archive/v1.6.68.tar.gz",
                    "sha256": "d9db0c0a518aa6ac0359626f222707c6ca1b63a83cbf229d97a5999c9cde347b"
                },
                {
                    "type": "patch",
                    "path": "opencollada-include-pcre-h.patch"
                }
            ],
            "cleanup": [
                "/include",
                "/lib/opencollada"
            ]
        },
        {
            "name": "tbb",
            "buildsystem": "simple",
            "build-commands": [
                "make tbb tbbmalloc tbbproxy",
                "install -p -D -m755 build/linux_*_release/libtbb.so.2 /app/lib/libtbb.so.2",
                "ln -s libtbb.so.2 /app/lib/libtbb.so",
                "install -p -D -m755 build/linux_*_release/libtbbmalloc.so.2 /app/lib/libtbbmalloc.so.2",
                "ln -s libtbb.so.2 /app/lib/libtbbmalloc.so",
                "install -p -D -m755 build/linux_*_release/libtbbmalloc_proxy.so.2 /app/lib/libtbbmalloc_proxy.so.2",
                "ln -s libtbb.so.2 /app/lib/libtbbmalloc_proxy.so",
                "cp -dR --preserve=mode,timestamp include/tbb /app/include/"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/01org/tbb/archive/2019_U3.tar.gz",
                    "sha256": "b2244147bc8159cdd8f06a38afeb42f3237d3fc822555499d7ccfbd4b86f8ece"
                }
            ],
            "cleanup": [
                "/include"
            ]
        },
        {
            "name": "blosc",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=RelWithDebInfo",
                "-DBUILD_BENCHMARKS:BOOL=OFF",
                "-DBUILD_STATIC:BOOL=OFF",
                "-DBUILD_TESTS:BOOL=OFF"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/Blosc/c-blosc/archive/v1.14.4.tar.gz",
                    "sha256": "42a85de871d142cdc89b607a90cceeb0eab60d995f6fae8d44aae397ab414002"
                }
            ],
            "cleanup": [
                "/include",
                "/lib/*.a"
            ]
        },
        {
            "name": "jemalloc",
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/jemalloc/jemalloc/releases/download/5.1.0/jemalloc-5.1.0.tar.bz2",
                    "sha256": "5396e61cc6103ac393136c309fae09e44d74743c86f90e266948c50f3dbb7268"
                }
            ],
            "cleanup": [
                "/bin",
                "/include",
                "/lib/*.a",
                "/lib/pkgconfig",
                "/share/doc",
                "/share/man"
            ]
        },
        {
            "name": "openvdb",
            "subdir": "openvdb",
            "buildsystem": "simple",
            "build-commands": [
                "make lib HDSO=/app/lib HT=/app DESTDIR=/app LOG4CPLUS_INCL_DIR= GLFW_INCL_DIR= PYTHON_VERSION= DOXYGEN= install"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/AcademySoftwareFoundation/openvdb/archive/v5.1.0.tar.gz",
                    "sha256": "eb5a8011732bcdeb115de9a38f640ee376bcb85b54e060d3b1ab08f9dc92f40b"
                }
            ],
            "cleanup": [
                "/bin",
                "/include",
                "/lib/*.a"
            ]
        },
        {
            "name": "alembic",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                "-DCMAKE_BUILD_TYPE=RelWithDebInfo",
                "-DUSE_ARNOLD:BOOL=OFF",
                "-DUSE_BINARIES:BOOL=OFF",
                "-DUSE_EXAMPLES:BOOL=OFF",
                "-DUSE_HDF5:BOOL=OFF",
                "-DUSE_MAYA:BOOL=OFF",
                "-DUSE_PRMAN:BOOL=OFF",
                "-DUSE_PYALEMBIC:BOOL=OFF",
                "-DUSE_STATIC_HDF5:BOOL=OFF",
                "-DUSE_TESTS:BOOL=OFF",
                "-DALEMBIC_ILMBASE_LINK_STATIC:BOOL=OFF",
                "-DALEMBIC_SHARED_LIBS:BOOL=OFF",
                "-DALEMBIC_SHARED_LIBS:BOOL=ON"
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://github.com/alembic/alembic/archive/1.7.10.tar.gz",
                    "sha256": "ce77e048dabd2e11e1c69088bd8f4d949f752dfabe81b297aab652c82c6a4ada"
                }
            ],
            "cleanup": [
                "/include",
                "/lib/cmake"
            ]
        },
        {
            "name": "certifi",
            "buildsystem": "simple",
            "build-commands": [
                "/usr/bin/pip3 --disable-pip-version-check install --prefix=/app --no-deps --verbose ."
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/source/c/certifi/certifi-2018.11.29.tar.gz",
                    "sha256": "47f9c83ef4c0c621eaef743f133f09fa8a74a9b75f037e8624f83bd1b6626cb7"
                }
            ]
        },
        {
            "name": "chardet",
            "buildsystem": "simple",
            "build-commands": [
                "/usr/bin/pip3 --disable-pip-version-check install --prefix=/app --no-deps --verbose ."
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/source/c/chardet/chardet-3.0.4.tar.gz",
                    "sha256": "84ab92ed1c4d4f16916e05906b6b75a6c0fb5db821cc65e70cbd64a3e2a5eaae"
                }
            ],
            "cleanup": [
                "/bin"
            ]
        },
        {
            "name": "idna",
            "buildsystem": "simple",
            "build-commands": [
                "/usr/bin/pip3 --disable-pip-version-check install --prefix=/app --no-deps --verbose ."
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/source/i/idna/idna-2.8.tar.gz",
                    "sha256": "c357b3f628cf53ae2c4c05627ecc484553142ca23264e593d327bcde5e9c3407"
                }
            ]
        },
        {
            "name": "urllib3",
            "buildsystem": "simple",
            "build-commands": [
                "/usr/bin/pip3 --disable-pip-version-check install --prefix=/app --no-deps --verbose ."
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/source/u/urllib3/urllib3-1.24.1.tar.gz",
                    "sha256": "de9529817c93f27c8ccbfead6985011db27bd0ddfcdb2d86f3f663385c6a9c22"
                }
            ]
        },
        {
            "name": "requests",
            "buildsystem": "simple",
            "build-commands": [
                "/usr/bin/pip3 --disable-pip-version-check install --prefix=/app --no-deps --verbose ."
            ],
            "sources": [
                {
                    "type": "archive",
                    "url": "https://files.pythonhosted.org/packages/source/r/requests/requests-2.21.0.tar.gz",
                    "sha256": "502a824f31acdacb3a35b6690b5fbf0bc41d63a24a45c4004352b0242707598e"
                }
            ]
        },
        {
            "name": "blender",
            "buildsystem": "cmake-ninja",
            "builddir": true,
            "config-opts": [
                /* Same as upstream official builds */
                "-DWITH_ALEMBIC:BOOL=ON",
                "-DWITH_ASSERT_ABORT:BOOL=OFF",
                "-DWITH_BUILDINFO:BOOL=ON",
                "-DWITH_BULLET:BOOL=ON",
                "-DWITH_CODEC_AVI:BOOL=ON",
                "-DWITH_CODEC_FFMPEG:BOOL=ON",
                "-DWITH_CODEC_SNDFILE:BOOL=ON",
                "-DWITH_CYCLES:BOOL=ON",
                "-DWITH_CYCLES_OSL:BOOL=ON",
                "-DWITH_FFTW3:BOOL=ON",
                "-DWITH_LIBMV:BOOL=ON",
                "-DWITH_LIBMV_SCHUR_SPECIALIZATIONS:BOOL=ON",
                "-DWITH_COMPOSITOR:BOOL=ON",
                "-DWITH_FREESTYLE:BOOL=ON",
                "-DWITH_GHOST_XDND:BOOL=ON",
                "-DWITH_IK_SOLVER:BOOL=ON",
                "-DWITH_IK_ITASC:BOOL=ON",
                "-DWITH_IMAGE_CINEON:BOOL=ON",
                "-DWITH_IMAGE_DDS:BOOL=ON",
                "-DWITH_IMAGE_HDR:BOOL=ON",
                "-DWITH_IMAGE_OPENEXR:BOOL=ON",
                "-DWITH_IMAGE_OPENJPEG:BOOL=ON",
                "-DWITH_IMAGE_TIFF:BOOL=ON",
                "-DWITH_INTERNATIONAL:BOOL=ON",
                "-DWITH_JACK:BOOL=ON",
                "-DWITH_LZMA:BOOL=ON",
                "-DWITH_LZO:BOOL=ON",
                "-DWITH_MOD_FLUID:BOOL=ON",
                "-DWITH_MOD_REMESH:BOOL=ON",
                "-DWITH_MOD_SMOKE:BOOL=ON",
                "-DWITH_MOD_OCEANSIM:BOOL=ON",
                "-DWITH_AUDASPACE:BOOL=ON",
                "-DWITH_OPENAL:BOOL=ON",
                "-DWITH_OPENCOLLADA:BOOL=ON",
                "-DWITH_OPENCOLORIO:BOOL=ON",
                "-DWITH_OPENMP:BOOL=ON",
                "-DWITH_OPENSUBDIV:BOOL=ON",
                "-DWITH_OPENVDB:BOOL=ON",
                "-DWITH_OPENVDB_BLOSC:BOOL=ON",
                "-DWITH_RAYOPTIMIZATION:BOOL=ON",
                "-DWITH_SDL:BOOL=ON",
                "-DWITH_X11_XINPUT:BOOL=ON",
                "-DWITH_X11_XF86VMODE:BOOL=ON",
                "-DWITH_MEM_JEMALLOC:BOOL=ON",
                "-DWITH_CYCLES_CUDA_BINARIES:BOOL=ON",
                "-DCYCLES_CUDA_BINARIES_ARCH:STRING=sm_30;sm_35;sm_37;sm_50;sm_52;sm_60;sm_61;sm_70;sm_72;sm_75",

                /* Changed from upstream official builds */
                "-DCMAKE_BUILD_TYPE=RelWithDebInfo",
                "-DPYTHON_NUMPY_PATH:PATH=/app/lib/python3.7/site-packages",
                "-DWITH_DOC_MANPAGE:BOOL=OFF",
                "-DWITH_INPUT_NDOF:BOOL=OFF",
                "-DWITH_INSTALL_PORTABLE:BOOL=OFF",
                "-DWITH_JACK:BOOL=OFF",
                "-DWITH_PYTHON_INSTALL:BOOL=OFF"
            ],
            "post-install": [
                "mkdir -p /app/share/appdata",
                "install -m644 -p ../org.blender.Blender.appdata.xml /app/share/appdata/"
            ],
            "sources": [
                {
                    "type": "git",
                    "url": "https://git.blender.org/blender.git",
                    "branch": "38673621a44cc8f321aee7dc7ec203adb65e0029"
                },
                {
                    "type": "file",
                    "path": "org.blender.Blender.appdata.xml"
                }
            ],
            "cleanup": [
                "/share/doc"
            ]
        }
    ]
}
